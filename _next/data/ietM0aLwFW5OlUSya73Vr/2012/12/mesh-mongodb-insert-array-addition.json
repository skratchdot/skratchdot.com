{"pageProps":{"post":{"year":"2012","month":"12","day":"12","slug":"mesh-mongodb-insert-array-addition","filename":"2012-12-12-mesh-mongodb-insert-array-addition.md","html":"<p>I just updated <a href=\"https://www.skratchdot.com/projects/mesh/\">mesh - MongoDB Extended Shell</a>\nagain by adding a function that you can call on <a href=\"http://www.mongodb.org/\">MongoDB</a> collections.</p>\n<p>The new function is called <strong>insertArray()</strong>.</p>\n<p>It allows you to insert an array of objects into a collection using a shell version of\n<a href=\"http://en.wikipedia.org/wiki/Syntactic_sugar\">Syntactic Sugar</a>.</p>\n<p>All it does is loop through the array that was passed in, calling\n<strong>DBCollection.insert()</strong> on each object in the array.</p>\n<p>If an item in the array is not an object, it will skip the insert, print a warning, and continue\nprocessing the next item in the array.</p>\n<p>If you don't pass in a valid array, it will throw an error.</p>\n<p>Example uses are:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// insert 2 items into myCollection</span>\n<span class=\"hljs-keyword\">var</span> myArray = [\n  { <span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">test</span>: <span class=\"hljs-number\">1</span> },\n  { <span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-attr\">test</span>: <span class=\"hljs-string\">'foo'</span> },\n];\ndb.<span class=\"hljs-property\">myCollection</span>.<span class=\"hljs-title function_\">insertArray</span>(myArray);\n\n<span class=\"hljs-comment\">// transfer 10 items from collection1 into collection2</span>\ndb.<span class=\"hljs-property\">collection2</span>.<span class=\"hljs-title function_\">insertArray</span>(db.<span class=\"hljs-property\">collection1</span>.<span class=\"hljs-title function_\">find</span>().<span class=\"hljs-title function_\">limit</span>(<span class=\"hljs-number\">10</span>).<span class=\"hljs-title function_\">toArray</span>());\n</code></pre>\n<p>Below is the function definition. Rather than using\n<a href=\"http://en.wikipedia.org/wiki/Polyfill\">polyfills</a>, it relies\n<a href=\"http://underscorejs.org/\">underscore.js</a> (which is included in\n<a href=\"https://www.skratchdot.com/projects/mesh/\">mesh.js</a>).</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">/*jslint nomen: true, plusplus: true */</span>\n<span class=\"hljs-comment\">/*global _, DBCollection, print */</span>\n<span class=\"hljs-comment\">/**\n * <span class=\"hljs-doctag\">@function</span>\n * <span class=\"hljs-doctag\">@name</span> <span class=\"hljs-variable\">insertArray</span>\n * <span class=\"hljs-doctag\">@memberOf</span> <span class=\"hljs-variable\">DBCollection</span>\n * <span class=\"hljs-doctag\">@param</span> {<span class=\"hljs-type\">array</span>} <span class=\"hljs-variable\">arr</span> - The array of objects to insert.\n * <span class=\"hljs-doctag\">@param</span> {<span class=\"hljs-type\">object</span>} <span class=\"hljs-variable\">options</span> - pass through to DBCollection.prototype.insert()\n * <span class=\"hljs-doctag\">@param</span> {<span class=\"hljs-type\">boolean</span>} <span class=\"hljs-variable\">_allow_dot</span> - pass through to DBCollection.prototype.insert()\n * <span class=\"hljs-doctag\">@throws</span> {<span class=\"hljs-type\">Exception</span>} - when arr is not an Array.\n */</span>\n<span class=\"hljs-title class_\">DBCollection</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">insertArray</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">arr, options, _allow_dot</span>) {\n  <span class=\"hljs-string\">'use strict'</span>;\n  <span class=\"hljs-keyword\">var</span> i, obj;\n  <span class=\"hljs-keyword\">if</span> (_.<span class=\"hljs-title function_\">isArray</span>(arr)) {\n    <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; arr.<span class=\"hljs-property\">length</span>; i++) {\n      obj = arr[i];\n      <span class=\"hljs-keyword\">if</span> (_.<span class=\"hljs-title function_\">isObject</span>(obj) &amp;&amp; !_.<span class=\"hljs-title function_\">isFunction</span>(obj)) {\n        <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">insert</span>(obj, options, _allow_dot);\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">'Cannot insert a non-object, so skipping: '</span> + obj);\n      }\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-string\">'first argument is not an array!'</span>;\n  }\n};\n</code></pre>\n","frontmatter":{"layout":"post","title":"mesh: MongoDB insertArray() addition","published":true,"categories":["MongoDB","Shell"],"tags":["MongoDB","Shell","Shell Extensions","Projects","Update"]}},"previousTitle":"New Tabs and the Back Button - Bookmarklet","previousUrl":"/2012/12/new-tabs-and-the-back-button-bookmarklet","nextTitle":"Open Electribe Editor - v1.1.0 Released","nextUrl":"/2013/01/open-electribe-editor-v1-1-0-released"},"__N_SSG":true}