{"pageProps":{"post":{"year":"2009","month":"09","day":"22","slug":"getting-wordpress-post-counts-to-show-up-inside-anchor-tag","filename":"2009-09-22-getting-wordpress-post-counts-to-show-up-inside-anchor-tag.md","html":"<p><em>NOTE: This post is referring to my old Wordpress blog. The theme has since changed.</em></p>\n<p>When creating this blog's theme, I decided I wanted the links in the side navigation\nto take up the full width of the navigation. Also, when hovering, I wanted to highlight\nthe whole link/line. This seems like a very simple thing to do with CSS, but by default,\na few of the Wordpress widgets do not allow for easy customization of the placement of the\npost count. This makes it hard to create sidebar entries in which the whole line is a link.</p>\n<p>For example, by default, I could only get the Archive Widget to print out links in the following format:</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"/2009/09/\"</span>&gt;</span>September 2009<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><span class=\"hljs-symbol\">&amp;nbsp;</span>(1)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n</code></pre>\n<p>I wanted the links to be in this format (note the (1) is inside the anchor tag):</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"/2009/09/\"</span>&gt;</span>September 2009<span class=\"hljs-symbol\">&amp;nbsp;</span>(1)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n</code></pre>\n<p>Below are the steps I took to override the default behavior of the Archive Widget.\nFor this tutorial, I'm going to modify the \"classic\" theme that is provided with Wordpress 2.8.\nYou can download both the original \"classic\" theme as well as my modified version\n\"classic-modified\" <a href=\"/downloads/theme-tutorial-classic-modified.zip\">here</a>.</p>\n<div class=\"info-section-note\">\nNOTE: For detailed instructions on creating a Wordpress theme, there are many tutorials online.  Also, the <a href=\"http://codex.wordpress.org/Theme_Development\">Wordpress.org</a> site has fairly detailed documentation.  The first tutorial I found via a google search was for entry level Wordpress developers, yet it was very helpful: <a href=\"http://www.wpdesigner.com/2007/02/19/so-you-want-to-create-wordpress-themes-huh/\">www.wpdesigner.com</a>.\n</div>\n\n<div>&nbsp;</div>\n\n<p>For this tutorial, the first step to take is to copy the \"classic\" theme. Rename the copy \"classic-modified\" and place it in your themes folder.</p>\n<p>Now we're going to modify the <b>functions.php</b> file by adding lines 17-18 below:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-meta\">&lt;?php</span>\n<span class=\"hljs-comment\">/**\n * <span class=\"hljs-doctag\">@package</span> WordPress\n * <span class=\"hljs-doctag\">@subpackage</span> Classic_Theme\n */</span>\n\n<span class=\"hljs-title function_ invoke__\">automatic_feed_links</span>();\n\n<span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-title function_ invoke__\">function_exists</span>(<span class=\"hljs-string\">'register_sidebar'</span>) )\n    <span class=\"hljs-title function_ invoke__\">register_sidebar</span>(<span class=\"hljs-keyword\">array</span>(\n        <span class=\"hljs-string\">'before_widget'</span> =&gt; <span class=\"hljs-string\">'&lt;li id=\"%1$s\" class=\"widget %2$s\"&gt;'</span>,\n        <span class=\"hljs-string\">'after_widget'</span> =&gt; <span class=\"hljs-string\">'&lt;/li&gt;'</span>,\n        <span class=\"hljs-string\">'before_title'</span> =&gt; <span class=\"hljs-string\">''</span>,\n        <span class=\"hljs-string\">'after_title'</span> =&gt; <span class=\"hljs-string\">''</span>,\n    ));\n\n<span class=\"hljs-comment\">// Include the script that replaces the default archive widget</span>\n<span class=\"hljs-keyword\">require_once</span>(<span class=\"hljs-string\">'functions-widgets.php'</span>);\n\n<span class=\"hljs-meta\">?&gt;</span>\n</code></pre>\n<p>Now create a blank file called <b>functions-widgets.php</b> and place it in your themes folder. Next, open the file <b>\"/wp-includes/default-widgets.php\"</b> and copy lines 210-271. Paste these lines in <b>functions-widgets.php</b> so it looks like the code below (Note I've added the opening and closing php tags):</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-meta\">&lt;?php</span>\n\n<span class=\"hljs-comment\">/**\n * Archives widget class\n *\n * <span class=\"hljs-doctag\">@since</span> 2.8.0\n */</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WP_Widget_Archives</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">WP_Widget</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">WP_Widget_Archives</span>(<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-variable\">$widget_ops</span> = <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'classname'</span> =&gt; <span class=\"hljs-string\">'widget_archive'</span>, <span class=\"hljs-string\">'description'</span> =&gt; <span class=\"hljs-title function_ invoke__\">__</span>( <span class=\"hljs-string\">'A monthly archive of your blog&amp;#8217;s posts'</span>) );\n        <span class=\"hljs-variable language_\">$this</span>-&gt;<span class=\"hljs-title function_ invoke__\">WP_Widget</span>(<span class=\"hljs-string\">'archives'</span>, <span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Archives'</span>), <span class=\"hljs-variable\">$widget_ops</span>);\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">widget</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$args</span>, <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-title function_ invoke__\">extract</span>(<span class=\"hljs-variable\">$args</span>);\n        <span class=\"hljs-variable\">$c</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'count'</span>] ? <span class=\"hljs-string\">'1'</span> : <span class=\"hljs-string\">'0'</span>;\n        <span class=\"hljs-variable\">$d</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'dropdown'</span>] ? <span class=\"hljs-string\">'1'</span> : <span class=\"hljs-string\">'0'</span>;\n        <span class=\"hljs-variable\">$title</span> = <span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_title'</span>, <span class=\"hljs-keyword\">empty</span>(<span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]) ? <span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Archives'</span>) : <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]);\n\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$before_widget</span>;\n        <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$title</span> )\n            <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$before_title</span> . <span class=\"hljs-variable\">$title</span> . <span class=\"hljs-variable\">$after_title</span>;\n\n        <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$d</span> ) {\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;select name=<span class=\"hljs-string\">\"archive-dropdown\"</span> onchange=<span class=\"hljs-string\">'document.location.href=this.options[this.selectedIndex].value;'</span>&gt; &lt;option value=<span class=\"hljs-string\">\"\"</span>&gt;<span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-title function_ invoke__\">esc_attr</span>(<span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Select Month'</span>)); <span class=\"hljs-meta\">?&gt;</span>&lt;/option&gt; <span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">wp_get_archives</span>(<span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_archives_dropdown_args'</span>, <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'type'</span> =&gt; <span class=\"hljs-string\">'monthly'</span>, <span class=\"hljs-string\">'format'</span> =&gt; <span class=\"hljs-string\">'option'</span>, <span class=\"hljs-string\">'show_post_count'</span> =&gt; <span class=\"hljs-variable\">$c</span>))); <span class=\"hljs-meta\">?&gt;</span> &lt;/select&gt;\n<span class=\"hljs-meta\">&lt;?php</span>\n        } <span class=\"hljs-keyword\">else</span> {\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;ul&gt;\n        <span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">wp_get_archives</span>(<span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_archives_args'</span>, <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'type'</span> =&gt; <span class=\"hljs-string\">'monthly'</span>, <span class=\"hljs-string\">'show_post_count'</span> =&gt; <span class=\"hljs-variable\">$c</span>))); <span class=\"hljs-meta\">?&gt;</span>\n        &lt;/ul&gt;\n<span class=\"hljs-meta\">&lt;?php</span>\n        }\n\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$after_widget</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">update</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$new_instance</span>, <span class=\"hljs-variable\">$old_instance</span> </span>) </span>{\n        <span class=\"hljs-variable\">$instance</span> = <span class=\"hljs-variable\">$old_instance</span>;\n        <span class=\"hljs-variable\">$new_instance</span> = <span class=\"hljs-title function_ invoke__\">wp_parse_args</span>( (<span class=\"hljs-keyword\">array</span>) <span class=\"hljs-variable\">$new_instance</span>, <span class=\"hljs-keyword\">array</span>( <span class=\"hljs-string\">'title'</span> =&gt; <span class=\"hljs-string\">''</span>, <span class=\"hljs-string\">'count'</span> =&gt; <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'dropdown'</span> =&gt; <span class=\"hljs-string\">''</span>) );\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>] = <span class=\"hljs-title function_ invoke__\">strip_tags</span>(<span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'title'</span>]);\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'count'</span>] = <span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'count'</span>] ? <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'dropdown'</span>] = <span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'dropdown'</span>] ? <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>;\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$instance</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">form</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-variable\">$instance</span> = <span class=\"hljs-title function_ invoke__\">wp_parse_args</span>( (<span class=\"hljs-keyword\">array</span>) <span class=\"hljs-variable\">$instance</span>, <span class=\"hljs-keyword\">array</span>( <span class=\"hljs-string\">'title'</span> =&gt; <span class=\"hljs-string\">''</span>, <span class=\"hljs-string\">'count'</span> =&gt; <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'dropdown'</span> =&gt; <span class=\"hljs-string\">''</span>) );\n        <span class=\"hljs-variable\">$title</span> = <span class=\"hljs-title function_ invoke__\">strip_tags</span>(<span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]);\n        <span class=\"hljs-variable\">$count</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'count'</span>] ? <span class=\"hljs-string\">'checked=\"checked\"'</span> : <span class=\"hljs-string\">''</span>;\n        <span class=\"hljs-variable\">$dropdown</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'dropdown'</span>] ? <span class=\"hljs-string\">'checked=\"checked\"'</span> : <span class=\"hljs-string\">''</span>;\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;p&gt;&lt;label <span class=\"hljs-keyword\">for</span>=<span class=\"hljs-string\">\"&lt;?php echo <span class=\"hljs-subst\">$this</span>-&gt;get_field_id('title'); ?&gt;\"</span>&gt;<span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">_e</span>(<span class=\"hljs-string\">'Title:'</span>); <span class=\"hljs-meta\">?&gt;</span>&lt;/label&gt; &lt;input <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">widefat</span>\" <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">title</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">title</span>'); ?&gt;\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">text</span>\" <span class=\"hljs-title\">value</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> <span class=\"hljs-title\">esc_attr</span>($<span class=\"hljs-title\">title</span>); ?&gt;\" /&gt;&lt;/<span class=\"hljs-title\">p</span>&gt;\n        &lt;<span class=\"hljs-title\">p</span>&gt;\n            &lt;<span class=\"hljs-title\">input</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">checkbox</span>\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">checkbox</span>\" &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">count</span>; ?&gt; <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">count</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">count</span>'); ?&gt;\" /&gt; &lt;<span class=\"hljs-title\">label</span> <span class=\"hljs-title\">for</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">count</span>'); ?&gt;\"&gt;&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">_e</span>('<span class=\"hljs-title\">Show</span> <span class=\"hljs-title\">post</span> <span class=\"hljs-title\">counts</span>'); ?&gt;&lt;/<span class=\"hljs-title\">label</span>&gt;\n            &lt;<span class=\"hljs-title\">br</span> /&gt;\n            &lt;<span class=\"hljs-title\">input</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">checkbox</span>\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">checkbox</span>\" &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">dropdown</span>; ?&gt; <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">dropdown</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">dropdown</span>'); ?&gt;\" /&gt; &lt;<span class=\"hljs-title\">label</span> <span class=\"hljs-title\">for</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">dropdown</span>'); ?&gt;\"&gt;&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">_e</span>('<span class=\"hljs-title\">Display</span> <span class=\"hljs-title\">as</span> <span class=\"hljs-title\">a</span> <span class=\"hljs-title\">drop</span> <span class=\"hljs-title\">down</span>'); ?&gt;&lt;/<span class=\"hljs-title\">label</span>&gt;\n        &lt;/<span class=\"hljs-title\">p</span>&gt;\n&lt;?<span class=\"hljs-title\">php</span>\n    }\n}\n\n?&gt;</span>\n</code></pre>\n<p>Now rename:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WP_Widget_Archives</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">WP_Widget</span> </span>{\n</code></pre>\n<p>to:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyTheme_Widget_Archives</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">WP_Widget</span> </span>{\n</code></pre>\n<p>We did this because we are effectively creating a new widget, so if we want to use the old \"Archives\" widget, we can.</p>\n<p>Now change the following function from:</p>\n<pre><code class=\"hljs language-php\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">WP_Widget_Archives</span>(<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-variable\">$widget_ops</span> = <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'classname'</span> =&gt; <span class=\"hljs-string\">'widget_archive'</span>, <span class=\"hljs-string\">'description'</span> =&gt; <span class=\"hljs-title function_ invoke__\">__</span>( <span class=\"hljs-string\">'A monthly archive of your blog&amp;#8217;s posts'</span>) );\n        <span class=\"hljs-variable language_\">$this</span>-&gt;<span class=\"hljs-title function_ invoke__\">WP_Widget</span>(<span class=\"hljs-string\">'archives'</span>, <span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Archives'</span>), <span class=\"hljs-variable\">$widget_ops</span>);\n    }\n</code></pre>\n<p>to:</p>\n<pre><code class=\"hljs language-php\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">MyTheme_Widget_Archives</span>(<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-variable\">$widget_ops</span> = <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'classname'</span> =&gt; <span class=\"hljs-string\">'widget_archive'</span>, <span class=\"hljs-string\">'description'</span> =&gt; <span class=\"hljs-title function_ invoke__\">__</span>( <span class=\"hljs-string\">'A monthly archive of your blog&amp;#8217;s posts'</span>) );\n        <span class=\"hljs-variable language_\">$this</span>-&gt;<span class=\"hljs-title function_ invoke__\">WP_Widget</span>(<span class=\"hljs-string\">'mytheme_archives'</span>, <span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'MyTheme Archives'</span>), <span class=\"hljs-variable\">$widget_ops</span>);\n    }\n</code></pre>\n<p>Notice that we not only changed the function name, but we changed the parameters to the WP_Widget call. We did this for the same reason explained above (this is a \"new\" widget, and we want to be able to switch back to the old version).</p>\n<div>&nbsp;</div>\n\n<p>For this next step, we are going to modify the <i>widget()</i>, <i>form()</i>, and <i>update()</i> calls. These are the functions that display the actual widget in the sidebar, and also display the widget details in the WordPress admin console. For this new widget, I am always going to display the post count, and I'm never going to display the archive results as a dropdown, so I can remove a few of the variables that are in the default archive widget ($c, $count, $d, $dropdown). To achieve this, you can modify <b>functions-widgets.php</b> like so:</p>\n<p>Before changes:</p>\n<pre><code class=\"hljs language-php\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">widget</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$args</span>, <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-title function_ invoke__\">extract</span>(<span class=\"hljs-variable\">$args</span>);\n        <span class=\"hljs-variable\">$c</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'count'</span>] ? <span class=\"hljs-string\">'1'</span> : <span class=\"hljs-string\">'0'</span>;\n        <span class=\"hljs-variable\">$d</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'dropdown'</span>] ? <span class=\"hljs-string\">'1'</span> : <span class=\"hljs-string\">'0'</span>;\n        <span class=\"hljs-variable\">$title</span> = <span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_title'</span>, <span class=\"hljs-keyword\">empty</span>(<span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]) ? <span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Archives'</span>) : <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]);\n\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$before_widget</span>;\n        <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$title</span> )\n            <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$before_title</span> . <span class=\"hljs-variable\">$title</span> . <span class=\"hljs-variable\">$after_title</span>;\n\n        <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$d</span> ) {\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;select name=<span class=\"hljs-string\">\"archive-dropdown\"</span> onchange=<span class=\"hljs-string\">'document.location.href=this.options[this.selectedIndex].value;'</span>&gt; &lt;option value=<span class=\"hljs-string\">\"\"</span>&gt;<span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-title function_ invoke__\">esc_attr</span>(<span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Select Month'</span>)); <span class=\"hljs-meta\">?&gt;</span>&lt;/option&gt; <span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">wp_get_archives</span>(<span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_archives_dropdown_args'</span>, <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'type'</span> =&gt; <span class=\"hljs-string\">'monthly'</span>, <span class=\"hljs-string\">'format'</span> =&gt; <span class=\"hljs-string\">'option'</span>, <span class=\"hljs-string\">'show_post_count'</span> =&gt; <span class=\"hljs-variable\">$c</span>))); <span class=\"hljs-meta\">?&gt;</span> &lt;/select&gt;\n<span class=\"hljs-meta\">&lt;?php</span>\n        } <span class=\"hljs-keyword\">else</span> {\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;ul&gt;\n        <span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">wp_get_archives</span>(<span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_archives_args'</span>, <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'type'</span> =&gt; <span class=\"hljs-string\">'monthly'</span>, <span class=\"hljs-string\">'show_post_count'</span> =&gt; <span class=\"hljs-variable\">$c</span>))); <span class=\"hljs-meta\">?&gt;</span>\n        &lt;/ul&gt;\n<span class=\"hljs-meta\">&lt;?php</span>\n        }\n\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$after_widget</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">update</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$new_instance</span>, <span class=\"hljs-variable\">$old_instance</span> </span>) </span>{\n        <span class=\"hljs-variable\">$instance</span> = <span class=\"hljs-variable\">$old_instance</span>;\n        <span class=\"hljs-variable\">$new_instance</span> = <span class=\"hljs-title function_ invoke__\">wp_parse_args</span>( (<span class=\"hljs-keyword\">array</span>) <span class=\"hljs-variable\">$new_instance</span>, <span class=\"hljs-keyword\">array</span>( <span class=\"hljs-string\">'title'</span> =&gt; <span class=\"hljs-string\">''</span>, <span class=\"hljs-string\">'count'</span> =&gt; <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'dropdown'</span> =&gt; <span class=\"hljs-string\">''</span>) );\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>] = <span class=\"hljs-title function_ invoke__\">strip_tags</span>(<span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'title'</span>]);\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'count'</span>] = <span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'count'</span>] ? <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'dropdown'</span>] = <span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'dropdown'</span>] ? <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>;\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$instance</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">form</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-variable\">$instance</span> = <span class=\"hljs-title function_ invoke__\">wp_parse_args</span>( (<span class=\"hljs-keyword\">array</span>) <span class=\"hljs-variable\">$instance</span>, <span class=\"hljs-keyword\">array</span>( <span class=\"hljs-string\">'title'</span> =&gt; <span class=\"hljs-string\">''</span>, <span class=\"hljs-string\">'count'</span> =&gt; <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'dropdown'</span> =&gt; <span class=\"hljs-string\">''</span>) );\n        <span class=\"hljs-variable\">$title</span> = <span class=\"hljs-title function_ invoke__\">strip_tags</span>(<span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]);\n        <span class=\"hljs-variable\">$count</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'count'</span>] ? <span class=\"hljs-string\">'checked=\"checked\"'</span> : <span class=\"hljs-string\">''</span>;\n        <span class=\"hljs-variable\">$dropdown</span> = <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'dropdown'</span>] ? <span class=\"hljs-string\">'checked=\"checked\"'</span> : <span class=\"hljs-string\">''</span>;\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;p&gt;&lt;label <span class=\"hljs-keyword\">for</span>=<span class=\"hljs-string\">\"&lt;?php echo <span class=\"hljs-subst\">$this</span>-&gt;get_field_id('title'); ?&gt;\"</span>&gt;<span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">_e</span>(<span class=\"hljs-string\">'Title:'</span>); <span class=\"hljs-meta\">?&gt;</span>&lt;/label&gt; &lt;input <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">widefat</span>\" <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">title</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">title</span>'); ?&gt;\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">text</span>\" <span class=\"hljs-title\">value</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> <span class=\"hljs-title\">esc_attr</span>($<span class=\"hljs-title\">title</span>); ?&gt;\" /&gt;&lt;/<span class=\"hljs-title\">p</span>&gt;\n        &lt;<span class=\"hljs-title\">p</span>&gt;\n            &lt;<span class=\"hljs-title\">input</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">checkbox</span>\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">checkbox</span>\" &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">count</span>; ?&gt; <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">count</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">count</span>'); ?&gt;\" /&gt; &lt;<span class=\"hljs-title\">label</span> <span class=\"hljs-title\">for</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">count</span>'); ?&gt;\"&gt;&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">_e</span>('<span class=\"hljs-title\">Show</span> <span class=\"hljs-title\">post</span> <span class=\"hljs-title\">counts</span>'); ?&gt;&lt;/<span class=\"hljs-title\">label</span>&gt;\n            &lt;<span class=\"hljs-title\">br</span> /&gt;\n            &lt;<span class=\"hljs-title\">input</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">checkbox</span>\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">checkbox</span>\" &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">dropdown</span>; ?&gt; <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">dropdown</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">dropdown</span>'); ?&gt;\" /&gt; &lt;<span class=\"hljs-title\">label</span> <span class=\"hljs-title\">for</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">dropdown</span>'); ?&gt;\"&gt;&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">_e</span>('<span class=\"hljs-title\">Display</span> <span class=\"hljs-title\">as</span> <span class=\"hljs-title\">a</span> <span class=\"hljs-title\">drop</span> <span class=\"hljs-title\">down</span>'); ?&gt;&lt;/<span class=\"hljs-title\">label</span>&gt;\n        &lt;/<span class=\"hljs-title\">p</span>&gt;\n&lt;?<span class=\"hljs-title\">php</span>\n    }\n}\n\n?&gt;</span>\n</code></pre>\n<p>After changes:</p>\n<pre><code class=\"hljs language-php\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">widget</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$args</span>, <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-title function_ invoke__\">extract</span>(<span class=\"hljs-variable\">$args</span>);\n        <span class=\"hljs-variable\">$title</span> = <span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'widget_title'</span>, <span class=\"hljs-keyword\">empty</span>(<span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]) ? <span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'Archives'</span>) : <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>]);\n\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$before_widget</span>;\n        <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$title</span> )\n            <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$before_title</span> . <span class=\"hljs-variable\">$title</span> . <span class=\"hljs-variable\">$after_title</span>;\n <span class=\"hljs-meta\">?&gt;</span>\n        &lt;ul&gt;\n            <span class=\"hljs-comment\">// We will complete this in the next step</span>\n        &lt;/ul&gt;\n<span class=\"hljs-meta\">&lt;?php</span>\n        }\n\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$after_widget</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">update</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$new_instance</span>, <span class=\"hljs-variable\">$old_instance</span> </span>) </span>{\n        <span class=\"hljs-variable\">$instance</span> = <span class=\"hljs-variable\">$old_instance</span>;\n        <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>] = <span class=\"hljs-title function_ invoke__\">strip_tags</span>(<span class=\"hljs-variable\">$new_instance</span>[<span class=\"hljs-string\">'title'</span>]);\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$instance</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">form</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-comment\">//Defaults</span>\n        <span class=\"hljs-variable\">$instance</span> = <span class=\"hljs-title function_ invoke__\">wp_parse_args</span>( (<span class=\"hljs-keyword\">array</span>) <span class=\"hljs-variable\">$instance</span>, <span class=\"hljs-keyword\">array</span>( <span class=\"hljs-string\">'title'</span> =&gt; <span class=\"hljs-string\">''</span>) );\n        <span class=\"hljs-variable\">$title</span> = <span class=\"hljs-title function_ invoke__\">esc_attr</span>( <span class=\"hljs-variable\">$instance</span>[<span class=\"hljs-string\">'title'</span>] );\n<span class=\"hljs-meta\">?&gt;</span>\n        &lt;p&gt;\n            &lt;label <span class=\"hljs-keyword\">for</span>=<span class=\"hljs-string\">\"&lt;?php echo <span class=\"hljs-subst\">$this</span>-&gt;get_field_id('title'); ?&gt;\"</span>&gt;<span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-title function_ invoke__\">_e</span>( <span class=\"hljs-string\">'Title:'</span> ); <span class=\"hljs-meta\">?&gt;</span>&lt;/label&gt;\n            &lt;input <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">widefat</span>\" <span class=\"hljs-title\">id</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_id</span>('<span class=\"hljs-title\">title</span>'); ?&gt;\" <span class=\"hljs-title\">name</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">get_field_name</span>('<span class=\"hljs-title\">title</span>'); ?&gt;\" <span class=\"hljs-title\">type</span>=\"<span class=\"hljs-title\">text</span>\" <span class=\"hljs-title\">value</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">title</span>; ?&gt;\" /&gt;\n        &lt;/<span class=\"hljs-title\">p</span>&gt;\n&lt;?<span class=\"hljs-title\">php</span>\n    }\n}\n\n?&gt;</span>\n</code></pre>\n<p>Now there's one final step. We need to actually display the archives. To do that, we need to modify the <i>widget()</i> function. In the last step, we were left with the following line:</p>\n<pre><code class=\"hljs language-php\">        &lt;ul&gt;\n            <span class=\"hljs-comment\">// We will complete this in the next step</span>\n        &lt;/ul&gt;\n</code></pre>\n<p>We are now going to complete this block of code. Open up <b>\"/wp-includes/general-template.php\"</b> and copy lines 799-825. Paste them into line 24 of <b>functions-widgets.php</b> which will give you:</p>\n<pre><code class=\"hljs language-php\">        &lt;ul&gt;\n        <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-string\">'monthly'</span> == <span class=\"hljs-variable\">$type</span> ) {\n            <span class=\"hljs-variable\">$query</span> = <span class=\"hljs-string\">\"SELECT YEAR(post_date) AS `year`, MONTH(post_date) AS `month`, count(ID) as posts FROM <span class=\"hljs-subst\">$wpdb</span>-&gt;posts <span class=\"hljs-subst\">$join</span> <span class=\"hljs-subst\">$where</span> GROUP BY YEAR(post_date), MONTH(post_date) ORDER BY post_date DESC <span class=\"hljs-subst\">$limit</span>\"</span>;\n            <span class=\"hljs-variable\">$key</span> = <span class=\"hljs-title function_ invoke__\">md5</span>(<span class=\"hljs-variable\">$query</span>);\n            <span class=\"hljs-variable\">$cache</span> = <span class=\"hljs-title function_ invoke__\">wp_cache_get</span>( <span class=\"hljs-string\">'wp_get_archives'</span> , <span class=\"hljs-string\">'general'</span>);\n            <span class=\"hljs-keyword\">if</span> ( !<span class=\"hljs-keyword\">isset</span>( <span class=\"hljs-variable\">$cache</span>[ <span class=\"hljs-variable\">$key</span> ] ) ) {\n                <span class=\"hljs-variable\">$arcresults</span> = <span class=\"hljs-variable\">$wpdb</span>-&gt;<span class=\"hljs-title function_ invoke__\">get_results</span>(<span class=\"hljs-variable\">$query</span>);\n                <span class=\"hljs-variable\">$cache</span>[ <span class=\"hljs-variable\">$key</span> ] = <span class=\"hljs-variable\">$arcresults</span>;\n                <span class=\"hljs-title function_ invoke__\">wp_cache_add</span>( <span class=\"hljs-string\">'wp_get_archives'</span>, <span class=\"hljs-variable\">$cache</span>, <span class=\"hljs-string\">'general'</span> );\n            } <span class=\"hljs-keyword\">else</span> {\n                <span class=\"hljs-variable\">$arcresults</span> = <span class=\"hljs-variable\">$cache</span>[ <span class=\"hljs-variable\">$key</span> ];\n            }\n            <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$arcresults</span> ) {\n                <span class=\"hljs-variable\">$afterafter</span> = <span class=\"hljs-variable\">$after</span>;\n                <span class=\"hljs-keyword\">foreach</span> ( (<span class=\"hljs-keyword\">array</span>) <span class=\"hljs-variable\">$arcresults</span> <span class=\"hljs-keyword\">as</span> <span class=\"hljs-variable\">$arcresult</span> ) {\n                    <span class=\"hljs-variable\">$url</span> = <span class=\"hljs-title function_ invoke__\">get_month_link</span>( <span class=\"hljs-variable\">$arcresult</span>-&gt;year, <span class=\"hljs-variable\">$arcresult</span>-&gt;month );\n                    <span class=\"hljs-variable\">$text</span> = <span class=\"hljs-title function_ invoke__\">sprintf</span>(<span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'%1$s %2$d'</span>), <span class=\"hljs-variable\">$wp_locale</span>-&gt;<span class=\"hljs-title function_ invoke__\">get_month</span>(<span class=\"hljs-variable\">$arcresult</span>-&gt;month), <span class=\"hljs-variable\">$arcresult</span>-&gt;year);\n                    <span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$show_post_count</span> )\n                        <span class=\"hljs-variable\">$after</span> = <span class=\"hljs-string\">'&amp;nbsp;('</span>.<span class=\"hljs-variable\">$arcresult</span>-&gt;posts.<span class=\"hljs-string\">')'</span> . <span class=\"hljs-variable\">$afterafter</span>;\n                    <span class=\"hljs-variable\">$output</span> .= <span class=\"hljs-title function_ invoke__\">get_archives_link</span>(<span class=\"hljs-variable\">$url</span>, <span class=\"hljs-variable\">$text</span>, <span class=\"hljs-variable\">$format</span>, <span class=\"hljs-variable\">$before</span>, <span class=\"hljs-variable\">$after</span>);\n                }\n            }\n        &lt;/ul&gt;\n</code></pre>\n<p>The first thing you'll notice is the <b>if ( 'monthly' == $type )</b> statement.  We can remove this clause, because the \"custom archive plugin\" will only show archives by month (I wanted to keep it simple- no need for other display types).  Also, this code is using a few global variables ($wpdb, $wp_locale) that aren't yet being used properly in our version of the <i>widget()</i> function. We need to modify <b>functions-widgets.php</b> again to have the following line which will declare our global variables for use inside the function:</p>\n<pre><code class=\"hljs language-php\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">widget</span>(<span class=\"hljs-params\"> <span class=\"hljs-variable\">$args</span>, <span class=\"hljs-variable\">$instance</span> </span>) </span>{\n        <span class=\"hljs-keyword\">global</span> <span class=\"hljs-variable\">$wpdb</span>, <span class=\"hljs-variable\">$wp_locale</span>;\n        <span class=\"hljs-title function_ invoke__\">extract</span>(<span class=\"hljs-variable\">$args</span>);\n</code></pre>\n<p>Also, when we copied code the first time, we didn't copy a few of the variables being used ($where and $join). Modify <b>functions-widgets.php</b> like so (adding lines 25-27):</p>\n<pre><code class=\"hljs language-php\">        &lt;ul&gt;\n        <span class=\"hljs-comment\">//filters</span>\n        <span class=\"hljs-variable\">$where</span> = <span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'getarchives_where'</span>, <span class=\"hljs-string\">\"WHERE post_type = 'post' AND post_status = 'publish'\"</span>, <span class=\"hljs-variable\">$r</span> );\n        <span class=\"hljs-variable\">$join</span> = <span class=\"hljs-title function_ invoke__\">apply_filters</span>(<span class=\"hljs-string\">'getarchives_join'</span>, <span class=\"hljs-string\">\"\"</span>, <span class=\"hljs-variable\">$r</span>);\n\n        <span class=\"hljs-variable\">$query</span> = <span class=\"hljs-string\">\"SELECT YEAR(post_date) AS `year`, MONTH(post_date) AS `month`, count(ID) as posts FROM <span class=\"hljs-subst\">$wpdb</span>-&gt;posts <span class=\"hljs-subst\">$join</span> <span class=\"hljs-subst\">$where</span> GROUP BY YEAR(post_date), MONTH(post_date) ORDER BY post_date DESC <span class=\"hljs-subst\">$limit</span>\"</span>;\n</code></pre>\n<p>Another thing about the code we copied: we can ignore the $post<em>count variable (since we are _always</em> showing post counts). We also want to make sure the post count shows up inside our anchor tag. To accomplish that, we can change:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-variable\">$url</span> = <span class=\"hljs-title function_ invoke__\">get_month_link</span>( <span class=\"hljs-variable\">$arcresult</span>-&gt;year, <span class=\"hljs-variable\">$arcresult</span>-&gt;month );\n<span class=\"hljs-variable\">$text</span> = <span class=\"hljs-title function_ invoke__\">sprintf</span>(<span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'%1$s %2$d'</span>), <span class=\"hljs-variable\">$wp_locale</span>-&gt;<span class=\"hljs-title function_ invoke__\">get_month</span>(<span class=\"hljs-variable\">$arcresult</span>-&gt;month), <span class=\"hljs-variable\">$arcresult</span>-&gt;year);\n<span class=\"hljs-keyword\">if</span> ( <span class=\"hljs-variable\">$show_post_count</span> )\n    <span class=\"hljs-variable\">$after</span> = <span class=\"hljs-string\">'&amp;nbsp;('</span>.<span class=\"hljs-variable\">$arcresult</span>-&gt;posts.<span class=\"hljs-string\">')'</span> . <span class=\"hljs-variable\">$afterafter</span>;\n<span class=\"hljs-variable\">$output</span> .= <span class=\"hljs-title function_ invoke__\">get_archives_link</span>(<span class=\"hljs-variable\">$url</span>, <span class=\"hljs-variable\">$text</span>, <span class=\"hljs-variable\">$format</span>, <span class=\"hljs-variable\">$before</span>, <span class=\"hljs-variable\">$after</span>);\n</code></pre>\n<p>to:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-variable\">$url</span> = <span class=\"hljs-title function_ invoke__\">get_month_link</span>( <span class=\"hljs-variable\">$arcresult</span>-&gt;year, <span class=\"hljs-variable\">$arcresult</span>-&gt;month );\n<span class=\"hljs-variable\">$text</span> = <span class=\"hljs-title function_ invoke__\">sprintf</span>(<span class=\"hljs-title function_ invoke__\">__</span>(<span class=\"hljs-string\">'%1$s %2$d'</span>), <span class=\"hljs-variable\">$wp_locale</span>-&gt;<span class=\"hljs-title function_ invoke__\">get_month</span>(<span class=\"hljs-variable\">$arcresult</span>-&gt;month), <span class=\"hljs-variable\">$arcresult</span>-&gt;year);\n<span class=\"hljs-variable\">$text</span> .= <span class=\"hljs-string\">'&amp;nbsp;('</span>.<span class=\"hljs-variable\">$arcresult</span>-&gt;posts.<span class=\"hljs-string\">')'</span> . <span class=\"hljs-variable\">$afterafter</span>;\n<span class=\"hljs-variable\">$output</span> .= <span class=\"hljs-title function_ invoke__\">get_archives_link</span>(<span class=\"hljs-variable\">$url</span>, <span class=\"hljs-variable\">$text</span>, <span class=\"hljs-variable\">$format</span>, <span class=\"hljs-string\">'&lt;li&gt;'</span>, <span class=\"hljs-string\">'&lt;/li&gt;'</span>);\n</code></pre>\n<p>Also add the correct output line before the <i>widget()</i> function ends:</p>\n<pre><code class=\"hljs language-php\">        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">'&lt;ul&gt;'</span> . <span class=\"hljs-variable\">$output</span> . <span class=\"hljs-string\">'&lt;/ul&gt;'</span>;\n        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-variable\">$after_widget</span>;\n</code></pre>\n<p>Our hacked/modified version is almost complete. The last thing I'm going to do is register the new archive widget (and unregister the default version). Do so by adding the following <i>mytheme_widget_init()</i> function to <b>functions-widgets.php</b>, then calling it:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-comment\">/**\n * Registering MyTheme Widgets\n * Removing a few default WordPress Widgets\n *\n * <span class=\"hljs-doctag\">@since</span> 1.0\n */</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">mytheme_widget_init</span>(<span class=\"hljs-params\"></span>) </span>{\n    <span class=\"hljs-comment\">// unregister some default widgets</span>\n    <span class=\"hljs-title function_ invoke__\">unregister_widget</span>(<span class=\"hljs-string\">'WP_Widget_Archives'</span>);\n\n    <span class=\"hljs-comment\">// register my own widgets</span>\n    <span class=\"hljs-title function_ invoke__\">register_widget</span>(<span class=\"hljs-string\">'MyTheme_Widget_Archives'</span>);\n}\n\n<span class=\"hljs-title function_ invoke__\">add_action</span>(<span class=\"hljs-string\">'widgets_init'</span>, <span class=\"hljs-string\">'mytheme_widget_init'</span>);\n</code></pre>\n<p>After completing the above steps, your post count will show up inside the anchor tag. One final (optional) step is modifying the <b>style.css</b> file so archive links are highlighted when hovering. For the \"classic-modified\" theme, I'm going to add:</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-comment\">/* Custom styles for archive widget */</span>\n<span class=\"hljs-selector-class\">.widget_archive</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">ul</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> {\n  <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">0px</span>;\n  <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0px</span>;\n  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0px</span>;\n  <span class=\"hljs-attribute\">list-style</span>: none;\n  <span class=\"hljs-attribute\">display</span>: block;\n}\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span> {\n  <span class=\"hljs-attribute\">display</span>: block;\n  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> dotted <span class=\"hljs-number\">#666</span>;\n  <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0px</span>;\n  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0px</span>;\n}\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:link</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:visited</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:hover</span>,\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:active</span> {\n  <span class=\"hljs-attribute\">text-decoration</span>: none;\n}\n<span class=\"hljs-selector-class\">.widget_archive</span> <span class=\"hljs-selector-tag\">ul</span> <span class=\"hljs-selector-tag\">li</span> <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:hover</span> {\n  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#eee</span>;\n}\n</code></pre>\n<h4 style=\"text-decoration:underline\">Comparison of default archive widget behavior vs. modified version</h4>\n\n<div class=\"clearfix\" style=\"width:600px;margin:0 auto;\">\n    <div class=\"left\">\n        <p><b>BEFORE (default archive widget):</b></p>\n        <img src=\"/images/posts/2009/09/22/classic-screen.gif\" alt=\"BEFORE (default archive widget)\" title=\"Classic Theme Screenshot\" width=\"212\" height=\"102\">\n    </div>\n    <div class=\"right\">\n        <p><b>AFTER (modified archive widget):</b></p>\n        <img src=\"/images/posts/2009/09/22/classic-modified-screen.gif\" alt=\"AFTER (modified archive widget)\" title=\"Classic-Modified Theme Screenshot\" width=\"212\" height=\"102\">\n    </div>\n</div>\n","frontmatter":{"layout":"post","title":"Getting Wordpress Post Counts to show up inside anchor tag","categories":["Wordpress"],"tags":["PHP","Wordpress"],"type":"post","status":"publish"}},"previousTitle":"About","previousUrl":"/2009/09/about-this-blog","nextTitle":"Cannot insert duplicate key row in object 'xxx' with unique index 'yyy'","nextUrl":"/2009/09/cannot-insert-duplicate-key-row-in-object-xxx-with-unique-index-yyy"},"__N_SSG":true}