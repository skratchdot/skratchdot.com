{"pageProps":{"slug":"/projects/mongodb-flatten","filename":"_pages/projects/mongodb-flatten/index.md","html":"<h1 id=\"mongodb---flattenjs\">MongoDB - flatten.js</h1>\n<p><a href=\"https://www.skratchdot.com/projects/mongodb-flatten/\">Project Page</a><br><a href=\"https://github.com/skratchdot/mongodb-flatten/\">Source Code</a><br><a href=\"https://github.com/skratchdot/mongodb-flatten/issues/\">Issues</a></p>\n<h2 id=\"description\">Description:</h2>\n<p>This project provides a way to flatten documents into id/key/value\npairs. The flatten() function accepts a collectionName parameter.\nThis collection will be emptied, and the newly flattened data will\nbe stored there. If a collectionName is not passed, then a temporary\ncollection will be created with a name in the format: temp.flatten_TIMESTAMP.</p>\n<h2 id=\"usage\">Usage:</h2>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Flatten all user documents, and store the results in: temp.flatten_TIMESTAMP</span>\nresult = db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">flatten</span>();\n\n<span class=\"hljs-comment\">// Flatten all user documents, and store the result in the users_flattened collection</span>\nresult = db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">flatten</span>(<span class=\"hljs-string\">'users_flattened'</span>);\n\n<span class=\"hljs-comment\">// Flatten user documents that have the first name of Bob. Store in a collection</span>\nresult = db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-string\">'name.first'</span>: <span class=\"hljs-string\">'Bob'</span> }).<span class=\"hljs-title function_\">flatten</span>(<span class=\"hljs-string\">'users_flattened'</span>);\n\n<span class=\"hljs-comment\">// Flatten the first 20 user documents into a dynamically named collection</span>\nresult = db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">find</span>().<span class=\"hljs-title function_\">limit</span>(<span class=\"hljs-number\">20</span>).<span class=\"hljs-title function_\">flatten</span>();\n\n<span class=\"hljs-comment\">// Get the number of keys in one document</span>\ndb.<span class=\"hljs-property\">users</span>\n  .<span class=\"hljs-title function_\">find</span>({\n    <span class=\"hljs-attr\">_id</span>: <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">'4f9c2374992274fc8d468675'</span>),\n  })\n  .<span class=\"hljs-title function_\">flatten</span>()\n  .<span class=\"hljs-title function_\">count</span>();\n</code></pre>\n<h2 id=\"example-result-set\">Example Result Set:</h2>\n<pre><code class=\"hljs language-javascript\">&gt; <span class=\"hljs-comment\">// Start fresh with a new collection called 'users'</span>\n&gt; db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">remove</span>();\n&gt;\n&gt; <span class=\"hljs-comment\">// Add a few records with different schemas</span>\n&gt; db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">insert</span>({<span class=\"hljs-string\">'name'</span> : {<span class=\"hljs-string\">'first'</span> : <span class=\"hljs-string\">'John'</span>, <span class=\"hljs-string\">'last'</span> : <span class=\"hljs-string\">'Smith'</span>}, <span class=\"hljs-string\">'isRegistered'</span> : <span class=\"hljs-literal\">false</span>, <span class=\"hljs-string\">'tags'</span> : [<span class=\"hljs-string\">'male'</span>]});\n&gt; db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">insert</span>({<span class=\"hljs-string\">'name'</span> : {<span class=\"hljs-string\">'first'</span> : <span class=\"hljs-string\">'Bob'</span>, <span class=\"hljs-string\">'last'</span> : <span class=\"hljs-string\">'Smith'</span>}, <span class=\"hljs-string\">'isRegistered'</span> : <span class=\"hljs-literal\">false</span>, <span class=\"hljs-string\">'tags'</span> : [<span class=\"hljs-string\">'male'</span>,<span class=\"hljs-string\">'new'</span>]});\n&gt; db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">insert</span>({<span class=\"hljs-string\">'name'</span> : {<span class=\"hljs-string\">'first'</span> : <span class=\"hljs-string\">'Amy'</span>, <span class=\"hljs-string\">'last'</span> : <span class=\"hljs-string\">'Smart'</span>}, <span class=\"hljs-string\">'isRegistered'</span> : <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'tags'</span> : [<span class=\"hljs-string\">'female'</span>]});\n&gt; db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">insert</span>({<span class=\"hljs-string\">'name'</span> : <span class=\"hljs-string\">'Bob Smith'</span>, <span class=\"hljs-string\">'isRegistered'</span> : <span class=\"hljs-string\">'0'</span>, <span class=\"hljs-string\">'tags'</span> : [<span class=\"hljs-string\">'male'</span>]});\n&gt;\n&gt; <span class=\"hljs-comment\">// Print our results to the console</span>\n&gt; db.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">flatten</span>().<span class=\"hljs-title function_\">find</span>();\n<span class=\"hljs-title class_\">Flattening</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-title function_\">document</span>(s) into the <span class=\"hljs-string\">\"temp.flatten_1350767969827\"</span> collection.\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e38\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"_id\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e38\"</span>) }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e38\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name.first\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"John\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e38\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name.last\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"Smith\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">4</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e38\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"isRegistered\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-literal\">false</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e38\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"tags.0\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"male\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">6</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"_id\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>) }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">7</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name.first\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"Bob\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">8</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name.last\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"Smith\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">9</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"isRegistered\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-literal\">false</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">10</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"tags.0\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"male\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">11</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e39\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"tags.1\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"new\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">12</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3a\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"_id\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3a\"</span>) }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">13</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3a\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name.first\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"Amy\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">14</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3a\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name.last\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"Smart\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">15</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3a\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"isRegistered\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-number\">1</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">16</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3a\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"tags.0\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"female\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">17</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3b\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"_id\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3b\"</span>) }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">18</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3b\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"name\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"Bob Smith\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">19</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3b\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"isRegistered\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"0\"</span> }\n{ <span class=\"hljs-string\">\"_id\"</span> : <span class=\"hljs-number\">20</span>, <span class=\"hljs-string\">\"i\"</span> : <span class=\"hljs-title class_\">ObjectId</span>(<span class=\"hljs-string\">\"5083156186df9e6600186e3b\"</span>), <span class=\"hljs-string\">\"k\"</span> : <span class=\"hljs-string\">\"tags.0\"</span>, <span class=\"hljs-string\">\"v\"</span> : <span class=\"hljs-string\">\"male\"</span> }\n</code></pre>\n<h2 id=\"installation\">Installation:</h2>\n<p>Download: <a href=\"https://github.com/skratchdot/mongodb-flatten/raw/master/flatten.js\">flatten.js</a></p>\n<h3 id=\"option-1\">Option 1</h3>\n<p>Add this script to your .mongorc.js file.</p>\n<p>See: <a href=\"http://www.mongodb.org/display/DOCS/Overview+-+The+MongoDB+Interactive+Shell#Overview-TheMongoDBInteractiveShell-.mongorc.js\">http://www.mongodb.org/display/DOCS/Overview+-+The+MongoDB+Interactive+Shell#Overview-TheMongoDBInteractiveShell-.mongorc.js</a></p>\n<h3 id=\"option-2\">Option 2</h3>\n<p>Start the shell after executing this script</p>\n<pre><code class=\"hljs language-plaintext\">mongo --shell flatten.js\n</code></pre>\n","frontmatter":{"layout":"page","title":"MongoDB - flatten.js"}},"__N_SSG":true}