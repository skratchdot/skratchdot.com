<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Userscripts and Content Security Policy » skratchdot.com</title><link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png"/><meta name="apple-mobile-web-app-title" content="skratchdot"/><link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96"/><link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16"/><link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="application-name" content="skratchdot"/><meta name="generator" content="NextJS"/><link rel="alternate" type="application/atom+xml" title="Atom Feed for skratchdot.com" href="/atom.xml"/><link rel="alternate" type="application/rss+xml" title="RSS Feed for skratchdot.com" href="/feed.xml"/><link rel="alternate" type="application/feed+json" title="JSON Feed for skratchdot.com" href="/feed.json"/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/9f6844b18498e4a4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9f6844b18498e4a4.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-682b8586cd82cc4e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4d21e19fd58c130c.js" defer=""></script><script src="/_next/static/chunks/31-c97ffeae2ceece59.js" defer=""></script><script src="/_next/static/chunks/257-c9cf42cec14b9e06.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-6b9de4fde1f1ef7e.js" defer=""></script><script src="/_next/static/ietM0aLwFW5OlUSya73Vr/_buildManifest.js" defer=""></script><script src="/_next/static/ietM0aLwFW5OlUSya73Vr/_ssgManifest.js" defer=""></script><script src="/_next/static/ietM0aLwFW5OlUSya73Vr/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="hrRed"></div><div class="hrBlack"></div><header class="oneColumn"><h1><a href="/">[skratchdot<span>.</span>]</a></h1></header><nav id="mainNav" class="oneColumn"><ul><li><a title="Home" href="/"><span>[</span>Home<span>]</span></a></li><li><a title="Projects" href="/projects/"><span>[</span>Projects<span>]</span></a></li><li><a title="Contact" href="/contact/"><span>[</span>Contact<span>]</span></a></li></ul></nav><br/><section class="oneColumn"><article><div class="title"><div class="date"><div><span>May</span> <span>19</span></div><div><span>2013</span></div></div><h2 class="title"><a href="/2013/05/userscripts-and-content-security-policy" rel="bookmark" title="Permanent Link to Userscripts and Content Security Policy">Userscripts and Content Security Policy</a></h2><div class="info"><div class="category"><a href="/category/Userscript/">Userscript</a>, <a href="/category/Javascript/">Javascript</a> </div><div class="pl-comments comments"><a href="/2013/05/userscripts-and-content-security-policy/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="/2013/05/userscripts-and-content-security-policy" data-disqus-url="/2013/05/userscripts-and-content-security-policy">Comments</span></a></div></div><div class="clearfix"> </div></div><div class="entry"><div><p>Last month, Github started to include some
<a href="https://en.wikipedia.org/wiki/Content_Security_Policy">Content Security Policy Headers</a>.</p>
<p>They wrote a <a href="https://github.com/blog/1477-content-security-policy">blog post</a> describing
the problems CSP headers try to solve, how to prepare your app for including the headers,
and listed some of the current limitations you may encounter when using the headers.</p>
<p>I've ran into some of these limitations with the Github userscripts I've authored.</p>
<p>First off, to make a cross browser userscript, there are a few problems that I've ran into.
If your userscript needs to access variables on a page, you can use a few techniques:</p>
<ul>
<li><a href="http://wiki.greasespot.net/UnsafeWindow">Unsafe Window</a></li>
<li><a href="http://wiki.greasespot.net/Location_hack">Location Hack</a></li>
<li><a href="http://wiki.greasespot.net/Content_Script_Injection">Content Script Injection</a></li>
</ul>
<p>Of these three, <strong>Content Script Injection</strong> is the preferred method. It works for both
Firefox and Chrome. I've been using a variation of that method for most of the scripts I've
written in the past.</p>
<p>Here's how I would typically write my scripts:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Create some js that you want to inject into the page</span>
<span class="hljs-keyword">var</span> main = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {};

<span class="hljs-comment">// Inject our main script into the page</span>
<span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
script.<span class="hljs-property">textContent</span> = <span class="hljs-string">'('</span> + main.<span class="hljs-title function_">toString</span>() + <span class="hljs-string">')();'</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);
</code></pre>
<p>After Github started sending CSP headers, my userscripts broke by throwing errors like:</p>
<pre><code class="hljs language-plaintext">CSP ERROR:  Couldn't parse invalid source 'unsafe-inline'
</code></pre>
<p>To fix Firefox, I temporarily removed the <strong>Content Script Injection</strong> hacks I was using. Here's
an example commit I made back in April:</p>
<p><a href="https://github.com/skratchdot/github-repo-counts.user.js/commit/80f77bc3d588ef5fcd411a3dc77062166b091713">https://github.com/skratchdot/github-repo-counts.user.js/commit/80f77bc3d588ef5fcd411a3dc77062166b091713</a></p>
<p>What I forgot when making those commits, is that Chrome userscripts do not work the same way as
Firefox userscripts.</p>
<p>To make Chrome userscripts work, I <em>needed</em> to use <strong>Content Script Injection</strong>. The issue is that
Github is sending the following CSP headers:</p>
<pre><code class="hljs language-plaintext">x-content-security-policy: default-src *; script-src https://github.com https://a248.e.akamai.net https://jobs.github.com https://ssl.google-analytics.com https://secure.gaug.es https://collector.githubapp.com https://gist.github.com; style-src https://github.com https://a248.e.akamai.net 'unsafe-inline'; object-src https://github.com https://a248.e.akamai.net
</code></pre>
<p>If you notice, I can only use the <strong>Content Script Injection</strong> method from the following domains:</p>
<ul>
<li><a href="https://github.com">https://github.com</a></li>
<li><a href="https://a248.e.akamai.net">https://a248.e.akamai.net</a></li>
<li><a href="https://jobs.github.com">https://jobs.github.com</a></li>
<li><a href="https://ssl.google-analytics.com">https://ssl.google-analytics.com</a></li>
<li><a href="https://secure.gaug.es">https://secure.gaug.es</a></li>
<li><a href="https://collector.githubapp.com">https://collector.githubapp.com</a></li>
<li><a href="https://gist.github.com">https://gist.github.com</a></li>
</ul>
<p>I had been hotlinking my scripts from the raw.github.com domain.</p>
<p>To fix, I started hosting my scripts in a <a href="https://gist.github.com/skratchdot/5604120">Gist</a>.</p>
<p>Since Firefox supports the @require userscript annotation, I rely on that. For Chrome, I am using
<strong>Content Script Injection</strong>. The reason I didn't use <strong>Content Script Injection</strong> for Firefox, is
because @require does some caching, and I was also experiencing some weird behavior in Firefox in
which certain requests to <a href="https://gist.github.com/">gist.github.com</a> were returning no content
(0 byte requests)- and my scripts weren't working.</p>
<p>I haven't experienced that behavior with Chrome requests.</p>
<p>Another method I was toying with, is by injecting the scripts via an iframe. Go to any
<a href="https://github.com/">github.com</a> page, and run the following code in Chrome's console:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> injectViaScript = <span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) {
  <span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
  script.<span class="hljs-property">textContent</span> = <span class="hljs-string">'('</span> + fn.<span class="hljs-title function_">toString</span>() + <span class="hljs-string">'());'</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(script);
};

<span class="hljs-keyword">var</span> injectViaIframe = <span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) {
  <span class="hljs-keyword">var</span> fnName = <span class="hljs-string">'dynamic_fn_'</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>(),
    iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
  iframe.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    parent.<span class="hljs-property">window</span>[fnName] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">'('</span> + fn.<span class="hljs-title function_">toString</span>() + <span class="hljs-string">'());'</span>);
    parent.<span class="hljs-property">window</span>[fnName]();
    parent.<span class="hljs-property">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(iframe);
  };
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);
};

<span class="hljs-comment">// This will throw an error</span>
<span class="hljs-title function_">injectViaScript</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-title function_">alert</span>(<span class="hljs-string">'Hello from script!'</span>);
});

<span class="hljs-comment">// This will work</span>
<span class="hljs-title function_">injectViaIframe</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-title function_">alert</span>(<span class="hljs-string">'Hello from iframe!'</span>);
});
</code></pre>
<p>That seemed like an approach I could take, but was running into scoping issues, so
gave up trying. I ended up settling on the @require method for Firefox, and the
<strong>Content Script Injection</strong> from <a href="https://gist.github.com/">gist.github.com</a> for Chrome.</p>
</div></div><div class="tagList">Tagged with: <a href="/tag/Userscript/">Userscript</a> • <a href="/tag/Javascript/">Javascript</a> • <a href="/tag/Git/">Git</a> • <a href="/tag/Github/">Github</a> • <a href="/tag/CSP/">CSP</a></div><div><br/><div style="border-bottom:1px dotted"></div><br/></div><div id="disqus_thread"></div><div id="disqus_thread"></div></article><nav id="articlesNav"><div><div class="newEntries"><a href="/2013/07/audio-sort-visualize-and-audibilize-sorting-algorithms/">« <!-- -->Audio Sort - Visualize and Audibilize Sorting Algorithms</a></div><div class="oldEntries"><a href="/2013/05/github-enhancement-suite/">Github Enhancement Suite<!-- --> »</a></div></div><div class="homeEntries"><a href="/">HOME</a></div></nav></section><div class="footerSpacer"><br/></div><footer class="oneColumn"><div>Copyright © <!-- -->2022<!-- --> <a href="/">skratchdot</a><span class="hspace">•</span>Validate:  <a href="https://validator.w3.org/nu/?doc=https%3A%2F%2Fwww.skratchdot.com%2F2013%2F05%2Fuserscripts-and-content-security-policy%2F">HTML5</a><span class="hspace">•</span><a class="noBorder" href="/atom.xml"><img src="/images/feed-icon-14x14.png" alt="RSS/Atom Feed" width="14" height="14" style="top:2px"/></a><span class="hspace">•</span><div class="twitter-button"><a class="twitter-button-link" target="_blank" aria-label="Follow @skratchdot on Twitter" title="Follow @skratchdot on Twitter" href="https://twitter.com/intent/user?screen_name=skratchdot"><i></i><span>Follow <b>@skratchdot</b></span></a></div></div></footer><a href="https://github.com/skratchdot" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#c80000;color:#000;position:absolute;top:0;border:0;right:0"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path><path d="M10,10 L115,115 L250,250 Z" stroke="black" stroke-width="6"></path></svg></a><div id="homepage_link"><a style="border:0" href="/"><img src="/favicon.ico" alt="skratchdot" width="16" height="16"/></a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"year":"2013","month":"05","day":"19","slug":"userscripts-and-content-security-policy","filename":"2013-05-19-userscripts-and-content-security-policy.md","html":"\u003cp\u003eLast month, Github started to include some\n\u003ca href=\"https://en.wikipedia.org/wiki/Content_Security_Policy\"\u003eContent Security Policy Headers\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThey wrote a \u003ca href=\"https://github.com/blog/1477-content-security-policy\"\u003eblog post\u003c/a\u003e describing\nthe problems CSP headers try to solve, how to prepare your app for including the headers,\nand listed some of the current limitations you may encounter when using the headers.\u003c/p\u003e\n\u003cp\u003eI've ran into some of these limitations with the Github userscripts I've authored.\u003c/p\u003e\n\u003cp\u003eFirst off, to make a cross browser userscript, there are a few problems that I've ran into.\nIf your userscript needs to access variables on a page, you can use a few techniques:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://wiki.greasespot.net/UnsafeWindow\"\u003eUnsafe Window\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://wiki.greasespot.net/Location_hack\"\u003eLocation Hack\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://wiki.greasespot.net/Content_Script_Injection\"\u003eContent Script Injection\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOf these three, \u003cstrong\u003eContent Script Injection\u003c/strong\u003e is the preferred method. It works for both\nFirefox and Chrome. I've been using a variation of that method for most of the scripts I've\nwritten in the past.\u003c/p\u003e\n\u003cp\u003eHere's how I would typically write my scripts:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// Create some js that you want to inject into the page\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e main = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {};\n\n\u003cspan class=\"hljs-comment\"\u003e// Inject our main script into the page\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e script = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'script'\u003c/span\u003e);\nscript.\u003cspan class=\"hljs-property\"\u003etextContent\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'('\u003c/span\u003e + main.\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e() + \u003cspan class=\"hljs-string\"\u003e')();'\u003c/span\u003e;\n\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(script);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter Github started sending CSP headers, my userscripts broke by throwing errors like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-plaintext\"\u003eCSP ERROR:  Couldn't parse invalid source 'unsafe-inline'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo fix Firefox, I temporarily removed the \u003cstrong\u003eContent Script Injection\u003c/strong\u003e hacks I was using. Here's\nan example commit I made back in April:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/skratchdot/github-repo-counts.user.js/commit/80f77bc3d588ef5fcd411a3dc77062166b091713\"\u003ehttps://github.com/skratchdot/github-repo-counts.user.js/commit/80f77bc3d588ef5fcd411a3dc77062166b091713\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eWhat I forgot when making those commits, is that Chrome userscripts do not work the same way as\nFirefox userscripts.\u003c/p\u003e\n\u003cp\u003eTo make Chrome userscripts work, I \u003cem\u003eneeded\u003c/em\u003e to use \u003cstrong\u003eContent Script Injection\u003c/strong\u003e. The issue is that\nGithub is sending the following CSP headers:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-plaintext\"\u003ex-content-security-policy: default-src *; script-src https://github.com https://a248.e.akamai.net https://jobs.github.com https://ssl.google-analytics.com https://secure.gaug.es https://collector.githubapp.com https://gist.github.com; style-src https://github.com https://a248.e.akamai.net 'unsafe-inline'; object-src https://github.com https://a248.e.akamai.net\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you notice, I can only use the \u003cstrong\u003eContent Script Injection\u003c/strong\u003e method from the following domains:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com\"\u003ehttps://github.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://a248.e.akamai.net\"\u003ehttps://a248.e.akamai.net\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://jobs.github.com\"\u003ehttps://jobs.github.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ssl.google-analytics.com\"\u003ehttps://ssl.google-analytics.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://secure.gaug.es\"\u003ehttps://secure.gaug.es\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://collector.githubapp.com\"\u003ehttps://collector.githubapp.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gist.github.com\"\u003ehttps://gist.github.com\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI had been hotlinking my scripts from the raw.github.com domain.\u003c/p\u003e\n\u003cp\u003eTo fix, I started hosting my scripts in a \u003ca href=\"https://gist.github.com/skratchdot/5604120\"\u003eGist\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eSince Firefox supports the @require userscript annotation, I rely on that. For Chrome, I am using\n\u003cstrong\u003eContent Script Injection\u003c/strong\u003e. The reason I didn't use \u003cstrong\u003eContent Script Injection\u003c/strong\u003e for Firefox, is\nbecause @require does some caching, and I was also experiencing some weird behavior in Firefox in\nwhich certain requests to \u003ca href=\"https://gist.github.com/\"\u003egist.github.com\u003c/a\u003e were returning no content\n(0 byte requests)- and my scripts weren't working.\u003c/p\u003e\n\u003cp\u003eI haven't experienced that behavior with Chrome requests.\u003c/p\u003e\n\u003cp\u003eAnother method I was toying with, is by injecting the scripts via an iframe. Go to any\n\u003ca href=\"https://github.com/\"\u003egithub.com\u003c/a\u003e page, and run the following code in Chrome's console:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e injectViaScript = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003efn\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e script = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'script'\u003c/span\u003e);\n  script.\u003cspan class=\"hljs-property\"\u003etextContent\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'('\u003c/span\u003e + fn.\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e() + \u003cspan class=\"hljs-string\"\u003e'());'\u003c/span\u003e;\n  \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(script);\n  \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eremoveChild\u003c/span\u003e(script);\n};\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e injectViaIframe = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003efn\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e fnName = \u003cspan class=\"hljs-string\"\u003e'dynamic_fn_'\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003egetTime\u003c/span\u003e(),\n    iframe = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'iframe'\u003c/span\u003e);\n  iframe.\u003cspan class=\"hljs-property\"\u003eonload\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    parent.\u003cspan class=\"hljs-property\"\u003ewindow\u003c/span\u003e[fnName] = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eFunction\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'('\u003c/span\u003e + fn.\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e() + \u003cspan class=\"hljs-string\"\u003e'());'\u003c/span\u003e);\n    parent.\u003cspan class=\"hljs-property\"\u003ewindow\u003c/span\u003e[fnName]();\n    parent.\u003cspan class=\"hljs-property\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eremoveChild\u003c/span\u003e(iframe);\n  };\n  \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(iframe);\n};\n\n\u003cspan class=\"hljs-comment\"\u003e// This will throw an error\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003einjectViaScript\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-title function_\"\u003ealert\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Hello from script!'\u003c/span\u003e);\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// This will work\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003einjectViaIframe\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-title function_\"\u003ealert\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Hello from iframe!'\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat seemed like an approach I could take, but was running into scoping issues, so\ngave up trying. I ended up settling on the @require method for Firefox, and the\n\u003cstrong\u003eContent Script Injection\u003c/strong\u003e from \u003ca href=\"https://gist.github.com/\"\u003egist.github.com\u003c/a\u003e for Chrome.\u003c/p\u003e\n","frontmatter":{"layout":"post","title":"Userscripts and Content Security Policy","published":true,"categories":["Userscript","Javascript"],"tags":["Userscript","Javascript","Git","Github","CSP"]}},"previousTitle":"Github Enhancement Suite","previousUrl":"/2013/05/github-enhancement-suite","nextTitle":"Audio Sort - Visualize and Audibilize Sorting Algorithms","nextUrl":"/2013/07/audio-sort-visualize-and-audibilize-sorting-algorithms"},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2013","month":"05","slug":"userscripts-and-content-security-policy"},"buildId":"ietM0aLwFW5OlUSya73Vr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>